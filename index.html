<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Secret Santa Group Game ðŸŽ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg,#0f172a,#1e293b);
      color:#e5e7eb; min-height:100vh;
      display:flex; justify-content:center; align-items:flex-start;
    }
    .container{ background:rgba(15,23,42,0.97); max-width:1000px;width:100%;
      margin:16px;padding:18px 16px 24px;border-radius:18px;
      border:1px solid rgba(148,163,184,.4); box-shadow:0 20px 45px rgba(0,0,0,.45);
    }
    h1{ font-size:1.7rem;text-align:center;margin:4px 0 10px;}
    .tabs{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;}
    .tab-btn{flex:1 1 150px;border-radius:999px;
      border:1px solid rgba(148,163,184,.5);
      background:rgba(15,23,42,.8);color:#e5e7eb;padding:6px 10px;
      font-size:.8rem;font-weight:600;cursor:pointer;}
    .tab-btn.active{background:#22c55e;color:#052e16;border-color:#22c55e;}
    .panel{display:none;margin-top:4px;} .panel.active{display:block;}
    label{font-size:.8rem;display:block;margin:6px 0 2px;color:#cbd5f5;}
    input,textarea{width:100%;border-radius:10px;border:1px solid rgba(75,85,99,.9);
      background:rgba(15,23,42,.9);color:#e5e7eb;padding:7px 9px;font-size:.85rem;}
    textarea{min-height:70px;resize:vertical;}
    input:focus,textarea:focus{border-color:#22c55e;box-shadow:0 0 0 1px rgba(34,197,94,.3);}
    .btn-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
    button{border-radius:999px;border:none;padding:7px 14px;font-size:.8rem;
      font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;}
    .btn-main{background:#22c55e;color:#052e16;}
    .btn-ghost{background:transparent;color:#e5e7eb;border:1px solid rgba(148,163,184,.7);}
    .small{font-size:.75rem;color:#9ca3af;}
    .box{border-radius:12px;border:1px solid rgba(55,65,81,.8);
      padding:10px 10px;margin-top:8px;background:rgba(15,23,42,.8);}
    .toast{ position:fixed;bottom:16px;right:16px;background:rgba(15,23,42,.98);
      border-radius:999px;padding:7px 13px;font-size:.78rem;border:1px solid rgba(34,197,94,.7);
      color:#bbf7d0;box-shadow:0 12px 30px rgba(0,0,0,.6);
      opacity:0;transform:translateY(10px);pointer-events:none;transition:.18s;}
    .toast.show{opacity:1;transform:translateY(0);}
  </style>
</head>
<body>
<div class="container">

  <h1>Secret Santa Group Game ðŸŽ„</h1>

  <div class="tabs">
    <button class="tab-btn active" data-tab="admin-create">1. Admin: Create Group</button>
    <button class="tab-btn" data-tab="join">2. Join & Rules</button>
    <button class="tab-btn" data-tab="admin-start">3. Start Game</button>
    <button class="tab-btn" data-tab="gift-status">4. Gift Status</button>
  </div>

  <!-- Create Group -->
  <div class="panel active" id="admin-create">
    <div class="box">
      <label>Group Name</label>
      <input id="inputGroupName" />
      <label>Admin Email</label>
      <input id="inputAdminEmail" />
      <button class="btn-main" id="btnCreateGroup">Create Group & Get Code</button>
      <p class="small" id="groupCodeInfo"></p>
    </div>
  </div>

  <!-- Join Group -->
  <div class="panel" id="join">
    <div class="box">
      <label>Group Code</label>
      <input id="inputJoinGroupCode" />
      <label>Your Name</label>
      <input id="inputJoinName" />
      <label>Your Email</label>
      <input id="inputJoinEmail" />
      <label>Your Wishlist</label>
      <textarea id="inputJoinWishlist"></textarea>

      <button class="btn-main" id="btnJoinGroup">Join Group</button>

      <hr>

      <label>Enter OTP</label>
      <input id="inputOtp" />

      <label style="display:flex;gap:6px;font-size:.8rem;">
        <input type="checkbox" id="checkRules"> I accept rules.
      </label>

      <button class="btn-main" id="btnVerifyAccept">Verify & Accept</button>
      <p id="joinStatus" class="small"></p>
    </div>
  </div>

  <!-- Admin Start -->
  <div class="panel" id="admin-start">
    <div class="box">
      <label>Group Code</label>
      <input id="inputAdminGroupCode" />
      <label>Admin Email</label>
      <input id="inputAdminStartEmail" />
      <button class="btn-main" id="btnCheckStatus">Check Status</button>
      <button class="btn-main" id="btnStartGame">Start Game</button>
      <p id="adminStatus" class="small"></p>
    </div>
  </div>

  <!-- Gift Status -->
  <div class="panel" id="gift-status">
    <div class="box">
      <label>Group Code</label>
      <input id="inputGiftGroupCode" />
      <label>Your Email</label>
      <input id="inputGiftEmail" />
      <label>Gift Photo Link</label>
      <input id="inputGiftPhoto" />
      <label>Status</label>
      <select id="selectGiftStatus">
        <option value="RECEIVED">Received</option>
        <option value="NOT_RECEIVED">Not Received</option>
      </select>
      <button class="btn-main" id="btnUpdateGift">Submit</button>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyecrBRcLg3DcAVFH8-_WeBxxPg3gfP2NWsj_o1p91Th-SLLG6r30Z5sB18Y8l2YoW1VQ/exec";

function showToast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

async function apiCall(action, payload){
  try{
    const response = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ action, ...payload })
    });
    return await response.json();
  } catch (err){
    console.log(err);
    showToast("Network error");
    return { ok:false };
  }
}

// Create Group
document.getElementById("btnCreateGroup").onclick = async ()=>{
  const name = document.getElementById("inputGroupName").value.trim();
  const email = document.getElementById("inputAdminEmail").value.trim();

  if(!name || !email){ showToast("Enter details"); return; }

  const res = await apiCall("createGroup",{ groupName:name, adminEmail:email });

  if(res.ok){
    document.getElementById("groupCodeInfo").textContent =
      "Group Code: " + res.groupCode;
    showToast("Created");
  }
};

// Join
document.getElementById("btnJoinGroup").onclick = async ()=>{
  const group = document.getElementById("inputJoinGroupCode").value.trim();
  const name = document.getElementById("inputJoinName").value.trim();
  const email = document.getElementById("inputJoinEmail").value.trim();
  const wish = document.getElementById("inputJoinWishlist").value.trim();

  const res = await apiCall("joinGroup",{ groupCode:group, name,email,wishlist:wish });
  document.getElementById("joinStatus").textContent = res.ok ? "Joined!" : res.error;
};

// OTP verify
document.getElementById("btnVerifyAccept").onclick = async ()=>{
  const group = document.getElementById("inputJoinGroupCode").value.trim();
  const email = document.getElementById("inputJoinEmail").value.trim();
  const otp = document.getElementById("inputOtp").value.trim();
  const rules = document.getElementById("checkRules").checked;

  if(!rules){ showToast("Accept rules first"); return; }

  const res = await apiCall("verifyOtp",{ groupCode:group,email,otp });
  if(!res.ok){ showToast(res.error); return; }

  await apiCall("acceptRules",{ groupCode:group,email });
  showToast("Verified");
};

// Admin Check
document.getElementById("btnCheckStatus").onclick = async ()=>{
  const group = document.getElementById("inputAdminGroupCode").value.trim();
  const email = document.getElementById("inputAdminStartEmail").value.trim();

  const res = await apiCall("checkGroupStatus",{ groupCode:group,adminEmail:email });

  document.getElementById("adminStatus").textContent =
    JSON.stringify(res);
};

// Start Game
document.getElementById("btnStartGame").onclick = async ()=>{
  const group = document.getElementById("inputAdminGroupCode").value.trim();
  const email = document.getElementById("inputAdminStartEmail").value.trim();

  const res = await apiCall("startGame",{ groupCode:group,adminEmail:email });
  showToast(res.ok ? "Game started!" : res.error);
};

// Gift Update
document.getElementById("btnUpdateGift").onclick = async ()=>{
  const group = document.getElementById("inputGiftGroupCode").value.trim();
  const email = document.getElementById("inputGiftEmail").value.trim();
  const photo = document.getElementById("inputGiftPhoto").value.trim();
  const status = document.getElementById("selectGiftStatus").value;

  const res = await apiCall("updateGiftStatus",{ groupCode:group,email,photoUrl:photo,status });
  showToast(res.ok ? "Updated!" : "Error");
};
</script>

</body>
</html>
